<!-- RAPPORT -->
<div class="tab-pane fade" id="tab-rapport">

    <h4 class="mb-4 text-white">Rapport & Historique des mesures</h4>

    {% if aquarium.tests is empty %}
        <p class="text-white-50">Aucune mesure disponible pour cet aquarium.</p>
    {% else %}

        <!-- Résumé -->
        <div class="mb-4">
            <div class="alert alert-warning bg-opacity-10 border-warning text-white">
                <i class="bi bi-graph-up-arrow me-2"></i>
                Historique de {{ aquarium.tests|length }} analyses.
            </div>
        </div>

        <!-- Sélecteur -->
        <div class="row mb-4">
            <div class="col-md-4">
                <label class="form-label text-white-50">Paramètre à afficher</label>
                <select id="rapport-select" class="form-select">
                    <option value="ph">pH</option>
                    <option value="gh">GH</option>
                    <option value="kh">KH</option>
                    <option value="no2">NO₂</option>
                    <option value="no3">NO₃</option>
                    <option value="nhx">NH₃/NH₄</option>
                    <option value="conductivite">Conductivité</option>
                </select>
            </div>
        </div>

        <!-- Canvas -->
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <canvas id="rapportChart" height="120"></canvas>
            </div>
        </div>

        <!-- Table des analyses brutes -->
        <h5 class="mt-5 mb-3 text-white">Tableau détaillé</h5>
        <div class="table-responsive">
            <table class="table table-dark table-striped table-sm align-middle">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>pH</th>
                        <th>GH</th>
                        <th>KH</th>
                        <th>NO₂</th>
                        <th>NO₃</th>
                        <th>NH₄/NH₃</th>
                        <th>Conductivité</th>
                        <th>Commentaire</th>
                    </tr>
                </thead>
                <tbody>
                {% for t in aquarium.tests %}
                    <tr>
                        <td>{{ t.date|date('d/m/Y') }}</td>
                        <td>{{ t.ph }}</td>
                        <td>{{ t.gh }}</td>
                        <td>{{ t.kh }}</td>
                        <td>{{ t.no2 }}</td>
                        <td>{{ t.no3 }}</td>
                        <td>{{ t.nhx }}</td>
                        <td>{{ t.conductivite }}</td>
                        <td>{{ t.comment ?? '—' }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    {% endif %}

</div>
